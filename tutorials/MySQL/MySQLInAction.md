# MySQL实战

[返回列表](https://github.com/EmonCodingBackEnd/backend-tutorial)

[TOC]

# 一、数据库设计规范

## 1、数据库命名规范

- 所有数据库对象名称必须使用小写字母并使用下划线分隔
- 所有数据库对象名称禁止使用MySQL保留关键字
- 数据库对象的命名要能做到见名知意，并且最好不要超过32个字符
- 临时库表必须以tmp为前缀并以日期为后缀
- 备份库，备份表必须以bak为前缀并以日期为后缀
- 所有存储相同数据的列名和列类型必须一致

## 2、数据库基本设计规范

- 所有表必须使用Innodb存储引擎
  - MySQL5.6之后，InnoDB已经成为了默认存储引擎
  - 支持事务，行级锁，更好的恢复性，高并发下性能更好
- 数据库和表的字符集统一使用UTF8（也可以统一到UTF8MB4）
  - 统一字符集可以避免由于字符集转换产生的乱码
  - MySQL中UTF8字符集汉字占3个字节，ASCII码占用1个字节
- 所有表和字段都需要添加注释
  - 从一开始就进行数据字典的维护
- 尽量的控制单表数据量的大小，建议控制在500万以内
  - 500万不是MySQL数据库的限制
  - 可以用历史数据归档，分库分表等手段来控制数据量大小
- 谨慎使用MySQL分区表
  - 分区表在物理上表现为多个文件，在逻辑上表现为一个表
  - 谨慎选择分区键，跨分区查询效率可能更低
  - 建议采用物理分表的方式管理大数据
- 尽量做到冷热数据分离，减小表的宽度
  - MySQL限制最多存储4096列
  - 每行数据的大小不能超过65535个字节
  - 减少磁盘IO，保证热数据的内存缓存命中率
  - 更有效的利用缓存，避免读入无用的冷数据
  - 经常一起使用的列放到一个表中
- 禁止在表中建立预留字段
  - 预留的字段命名很难做到见名知意
  - 预留字段无法确认存储的数据类型，所以无法选择合适的数据类型
  - 对预留字段类型的修改，会对表进行行级锁定
- 禁止在数据库中存储图片，文件等二进制数据
- 禁止在线上数据库压力测试
- 禁止从开发环境，测试环境直接连接生产环境数据库

## 3、数据库索引设计规范

**索引对数据库的查询性能来说是非常重要的**

- 不要滥用索引，限制每张表上的索引数量，建议单张表索引不超过5个

  - 索引并不是越多越好！索引可以提高效率同样可以降低效率
  - 禁止给表中的每一列都建立单独的索引
  - Innodb是按照哪一个索引的顺序来组织表的？
    - 答案是：主键

- 每个Innodb表必须有一个主键

  - 不使用更新频繁的列作为主键，不使用多列主键/联合主键
  - 不使用UUID，MD5，HASH，字符串列作为主键
  - 如果不能自己生成唯一、增长的主键，那么主键建议选择使用自增ID值

- 常见索引列建议

  - 在哪些列上建立索引呢？
    - SELECT、UPDATE、DELETE语句的WHERE从句中的列
    - 包含在ORDER BY、GROUP BY、DISTINCT中的字段
    - 多表JOIN的关联列
  - 如何选择索引列的顺序
    - 区分度最高的列放在联合索引的最左侧
    - 尽量把字段长度小的列放到联合索引的最左侧
    - 使用最频繁的列放到联合索引的最左侧

- 避免建立冗余索引和重复的索引

  - 重复索引示例：

  ```
  primary key(id)、index(id)、unique index(id)
  ```

  - 冗余索引示例：

  ```
  index(a,b,c)、index(a,b)、index(a)
  ```

- 对于频繁的查询优先考虑使用覆盖索引
  - 覆盖索引：就是包含了所有查询字段的索引
  - 覆盖索引的好处
    - 避免Innodb表进行索引的二次查找
    - 可以把随机IO变为顺序IO加快查询效率
- 尽量避免使用外键
  - 不建议使用外键约束，但一定在表与表之间的关联键上建立索引
  - 外键可用于保证数据的参照完整性，但建议在业务端实现
  - 外键会影响父表和子表的写操作从而降低性能

## 4、数据库字段设计规范



## 5、数据库SQL开发规范

## 6、数据库操作行为规范

